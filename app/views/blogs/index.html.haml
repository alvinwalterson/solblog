.main
	.header
		%pre
			= render 'layouts/messages'
	- if @name.nil?
		.header
			- if @type == Blog::BLOG_MYSOL && !@blogs.nil?
				= link_to 'Edit MySol', edit_blog_path(@blogs.first, type: Blog::BLOG_MYSOL)
			- else
				= link_to 'Add new blog', new_blog_path(type: Blog::BLOG_MAIN)
		%div
		%br
		%br
			%table#blog_edit_table{:align=> 'center'}
				%thead
					%td{:width=>100} Title
					%td{:width=>200} Body
					%td{:width=>150} Picture
					%td{:width=>100} Created At
					%td{:width=>100} Actions
				%tbody
					- if !@blogs.nil? && @blogs.length > 0
						- @blogs.each do |blog|
							%tr
								%td= blog.title
								%td= raw blog.body[0..100]
								%td= image_tag blog.picture.url(:thumb)
								%td= blog.created_at.strftime "%D"
								%td
									= link_to 'Edit', edit_blog_path(blog, type: @type)
									- if @type == Blog::BLOG_MYSOL
										= link_to 'Show', mysol_path
									- else
										= link_to 'Show', blog_path(blog, type: @type)
									- unless @type == Blog::BLOG_MYSOL
										= link_to 'Delete', blog_path(blog, type: Blog::BLOG_MAIN), method: :delete, data: {confirm: 'Are you sure?'}
					- else
						%tr
							%td{colspan: 5}
								%h3
									There's no blogs yet. Add 
									= link_to 'new blog', new_blog_path(type: @type)
									here.
	- else
		%h2 - Landing page
		.header
			= link_to 'Add New Blog', new_blog_path(type: @type, name: @name, category: @category)
		%table#blog_edit_table{:align=> 'center'}
			%thead
				%td{:width=>100} Title
				%td{:width=>200} Body
				%td{:width=>150} Picture
				%td{:width=>100} Created At
				%td{:width=>100} Actions
			%tbody
				- if @destination.length > 0
					- @destination.each do |blog|
						%tr
							%td= blog.title
							%td= raw blog.body[0..100]
							%td= image_tag blog.picture.url(:thumb)
							%td= blog.created_at.strftime "%D"
							%td
								= link_to 'Edit', edit_blog_path(blog, type: @type, name: @name, category: @category)
								= link_to 'Show', destination_path(name: @name)
								= link_to 'Delete', blog_path(blog, type: @type, name: @name, category: @category), method: :delete, data: {confirm: 'Are you sure?'}
				- else
					%tr
						%td{colspan: 5}
							%h3
								There's no blogs yet. Add 
								= link_to 'new blog', new_blog_path(type: @type, name: @name, category: true)
								here.
		
		%h2 - Select Top Blogs
		= form_for :top_blogs, url: select_top_path(type: @type, name: @name, category: true), method: :put do |f|
			%table#blog_edit_table{:align=> 'center'}
				%thead
					%td{:width=>100} Check
					%td{:width=>100} Title
					%td{:width=>200} Body
					%td{:width=>100} Type
					%td{:width=>100} Created At
				%tbody
					- if @location.sub_blogs.length > 0
						- @location.sub_blogs.each do |blog|
							%tr
								%td= f.check_box :featured, checked: blog.featured, name: 'blog[featured][]'
								= f.hidden_field :blog_id, value: blog.id, name: 'blog[selected][]'
								%td= blog.title
								%td= raw blog.body[0..100]
								%td= blog.blog_type
								%td= blog.created_at.strftime "%D"
			= f.submit

		%h2 - Eat Blogs
		.header
			= link_to 'Add New Blog', new_blog_path(type: Blog::BLOG_EAT, name: @name, category: false)
		%table#blog_edit_table{:align=> 'center'}
			%thead
				%td{:width=>100} Title
				%td{:width=>200} Body
				%td{:width=>150} Picture
				%td{:width=>100} Created At
				%td{:width=>100} Actions
			%tbody
				- if @location.blogs.eat.length > 0
					- @location.blogs.eat.each do |blog|
						%tr
							%td= blog.title
							%td= raw blog.body[0..100]
							%td= image_tag blog.picture.url(:thumb)
							%td= blog.created_at.strftime "%D"
							%td
								= link_to 'Edit', edit_blog_path(blog, type: Blog::BLOG_EAT, name: @name, category: false)
								= link_to 'Show', destination_path(name: @name)
								= link_to 'Delete', blog_path(blog, type: Blog::BLOG_EAT, name: @name, category: @category), method: :delete, data: {confirm: 'Are you sure?'}
				- else
					%tr
						%td{colspan: 5}
							%h3
								There's no blogs yet. Add 
								= link_to 'new blog', new_blog_path(type: Blog::BLOG_EAT, name: @name, category: false)
								here.

		%h2 - Stay Blogs
		.header
			= link_to 'Add New Blog', new_blog_path(type: Blog::BLOG_STAY, name: @name, category: false)
		%table#blog_edit_table{:align=> 'center'}
			%thead
				%td{:width=>100} Title
				%td{:width=>200} Body
				%td{:width=>150} Picture
				%td{:width=>100} Created At
				%td{:width=>100} Actions
			%tbody
				- if @location.blogs.stay.length > 0
					- @location.blogs.stay.each do |blog|
						%tr
							%td= blog.title
							%td= raw blog.body[0..100]
							%td= image_tag blog.picture.url(:thumb)
							%td= blog.created_at.strftime "%D"
							%td
								= link_to 'Edit', edit_blog_path(blog, type: Blog::BLOG_STAY, name: @name, category: false)
								= link_to 'Show', destination_path(name: @name)
								= link_to 'Delete', blog_path(blog, type: Blog::BLOG_STAY, name: @name, category: @category), method: :delete, data: {confirm: 'Are you sure?'}
				- else
					%tr
						%td{colspan: 5}
							%h3
								There's no blogs yet. Add 
								= link_to 'new blog', new_blog_path(type: Blog::BLOG_STAY, name: @name, category: false)
								here.

		%h2 - Play Blogs
		.header
			= link_to 'Add New Blog', new_blog_path(type: Blog::BLOG_PLAY, name: @name, category: false)
		%table#blog_edit_table{:align=> 'center'}
			%thead
				%td{:width=>100} Title
				%td{:width=>200} Body
				%td{:width=>150} Picture
				%td{:width=>100} Created At
				%td{:width=>100} Actions
			%tbody
				- if @location.blogs.play.length > 0
					- @location.blogs.play.each do |blog|
						%tr
							%td= blog.title
							%td= raw blog.body[0..100]
							%td= image_tag blog.picture.url(:thumb)
							%td= blog.created_at.strftime "%D"
							%td
								= link_to 'Edit', edit_blog_path(blog, type: Blog::BLOG_PLAY, name: @name, category: false)
								= link_to 'Show', destination_path(name: @name)
								= link_to 'Delete', blog_path(blog, type: Blog::BLOG_PLAY, name: @name, category: @category), method: :delete, data: {confirm: 'Are you sure?'}
				- else
					%tr
						%td{colspan: 5}
							%h3
								There's no blogs yet. Add 
								= link_to 'new blog', new_blog_path(type: Blog::BLOG_PLAY, name: @name, category: false)
								here.

		%h2 - Location Photos
		- @location.all_photos.each do |p|
			= image_tag p.picture.url(:thumb)
			= link_to 'Delete Photo', photo_path(p, name: @name, category: false), method: :delete, data: {confirm: 'Are you sure?'}

		= form_for :photo, url: photos_path(name: @name, category: false), method: :post, multipart: true do |f|
			= f.label :title
			= f.text_field :title
			= f.label :url
			= f.text_field :url
			= f.label :picture
			= f.file_field :picture
			= f.hidden_field :location_id, value: @location.id
			= f.hidden_field :landing, value: false

			= f.submit